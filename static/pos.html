<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema POS profesional para botiller√≠a - Punto de Venta">
    <meta name="theme-color" content="#2563eb">
    <title>Punto de Venta - Botiller√≠a POS</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="pos-style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar" role="navigation" aria-label="Navegaci√≥n principal">
        <div class="navbar-brand">
            <h1>üç∫ Botiller√≠a POS</h1>
        </div>
        <div class="navbar-menu" role="tablist">
            <button class="nav-btn active" data-view="pos" role="tab" aria-selected="true">
                <span class="icon" aria-hidden="true">üí∞</span>
                Punto de Venta
            </button>
            <a href="productos.html" class="nav-btn" role="tab">
                <span class="icon" aria-hidden="true">üì¶</span>
                Productos
            </a>
            <a href="retiros.html" class="nav-btn" role="tab">
                <span class="icon" aria-hidden="true">üì§</span>
                Retiros
            </a>
            <a href="ventas.html" class="nav-btn" role="tab">
                <span class="icon" aria-hidden="true">üìä</span>
                Reportes
            </a>
        </div>
        <div class="navbar-stats" aria-label="Estad√≠sticas del d√≠a">
            <div class="stat-item">
                <span class="stat-label">Ventas Hoy</span>
                <span class="stat-value" id="ventasHoy" aria-live="polite">$0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Retiros Hoy</span>
                <span class="stat-value warning" id="retirosHoy" aria-live="polite">$0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Utilidad Neta</span>
                <span class="stat-value success" id="utilidadNeta" aria-live="polite">$0</span>
            </div>
            <div class="stat-item cash-control">
                <button id="cashControlBtn" class="cash-control-btn">
                    <span class="cash-icon">üí∞</span>
                    <span id="cashStatus">Caja Cerrada</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Vista: Punto de Venta -->
    <main class="view active" role="tabpanel">
        <div class="pos-container">
            <!-- Panel de Productos -->
            <section class="products-panel" aria-label="Cat√°logo de productos">
                <div class="search-section">
                    <div class="search-input-group">
                        <input 
                            type="text" 
                            id="posSearchInput" 
                            placeholder="üîç Buscar por c√≥digo o nombre (F2)"
                            class="search-input"
                            autocomplete="off"
                            aria-label="B√∫squeda de productos"
                        >
                        <button id="codeSearchBtn" class="btn-action secondary code-search-btn" title="Buscar por c√≥digo de barras">
                            <span class="btn-icon">üì±</span>
                        </button>
                    </div>
                </div>

                <!-- Filtros compactos -->
                <div class="pos-filters" role="region" aria-label="Filtros de productos">
                    <div class="filter-row">
                        <!-- Filtros de categor√≠a como pills -->
                        <div class="category-pills" role="radiogroup" aria-label="Filtrar por categor√≠a">
                            <button class="pill active" data-categoria="" role="radio" aria-checked="true">
                                üåü Todos
                            </button>
                            <button class="pill" data-categoria="Cervezas" role="radio" aria-checked="false">
                                üç∫
                            </button>
                            <button class="pill" data-categoria="Vinos" role="radio" aria-checked="false">
                                üç∑
                            </button>
                            <button class="pill" data-categoria="Licores" role="radio" aria-checked="false">
                                ü•É
                            </button>
                            <button class="pill" data-categoria="Bebidas" role="radio" aria-checked="false">
                                ü•§
                            </button>
                            <button class="pill" data-categoria="Snacks" role="radio" aria-checked="false">
                                üçø
                            </button>
                        </div>
                        
                        <!-- Filtros adicionales en selects compactos -->
                        <div class="filter-selects">
                            <select id="unidadFilter" class="compact-select" aria-label="Filtrar por unidad">
                                <option value="">‚öñÔ∏è Unidad</option>
                            </select>
                            <select id="marcaFilter" class="compact-select" aria-label="Filtrar por marca">
                                <option value="">üè≠ Marca</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Grid de productos -->
                <div id="posProductsGrid" class="products-grid" role="grid" aria-label="Lista de productos disponibles"></div>
            </section>

            <!-- Panel de Carrito -->
            <aside class="cart-panel" role="complementary" aria-label="Carrito de compras">
                <!-- T√≠tulo del carrito -->
                <div class="cart-title">
                    <h2>üõí Carrito de Compra</h2>
                </div>
                
                <!-- Controles del carrito -->
                <div class="cart-controls">
                    <div class="quick-mode-toggle">
                        <input type="checkbox" id="quickModeToggle" class="toggle-checkbox">
                        <label for="quickModeToggle" class="toggle-label">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">‚ö° R√°pido</span>
                        </label>
                    </div>
                    <button id="clearCart" class="btn-action secondary" aria-label="Limpiar carrito">
                        <span class="btn-icon">üó±Ô∏è</span>
                        <span class="btn-text">Limpiar</span>
                    </button>
                </div>

                <!-- Container de productos con scroll -->
                <div class="cart-products-container">
                    <div id="cartItems" class="cart-items" role="list" aria-label="Productos en el carrito"></div>
                </div>

                <!-- Secci√≥n fija inferior -->
                <div class="cart-fixed-bottom">
                    <!-- Descuentos / Recargos -->
                    <div class="discount-section">
                        <div class="discount-header">
                            <span>üè∑Ô∏è Descuentos / Recargos</span>
                            <button id="toggleDiscount" class="btn-toggle">
                                <span class="btn-icon">‚ûï</span>
                            </button>
                        </div>
                        <div class="discount-controls" id="discountControls" style="display: none;">
                            <div class="discount-input-group">
                                <input type="number" id="discountAmount" placeholder="0" step="100" min="-999999" max="999999">
                                <label>Pesos CLP</label>
                            </div>
                            <div class="discount-buttons">
                                <button onclick="applyQuickDiscount(-5000)" class="quick-btn discount">üí∞ -$5.000</button>
                                <button onclick="applyQuickDiscount(-10000)" class="quick-btn discount">üí∞ -$10.000</button>
                                <button onclick="applyQuickDiscount(2000)" class="quick-btn surcharge">üìà +$2.000</button>
                                <button onclick="clearDiscount()" class="quick-btn clear">üóë Limpiar</button>
                            </div>
                        </div>
                    </div>

                    <footer class="cart-summary" role="region" aria-label="Resumen de compra">
                        <div class="summary-row">
                            <span>Items:</span>
                            <span id="cartItemCount" aria-live="polite">0</span>
                        </div>
                        <div class="summary-row subtotal">
                            <span>Subtotal:</span>
                            <span id="cartSubtotal" aria-live="polite">$0</span>
                        </div>
                        <div class="summary-row discount" id="discountRow" style="display: none;">
                            <span id="discountLabel">Descuento:</span>
                            <span id="discountDisplay" aria-live="polite">$0</span>
                        </div>
                        <div class="summary-row total">
                            <span>TOTAL:</span>
                            <span id="cartTotal" class="value" aria-live="assertive">$0</span>
                        </div>
                    </footer>

                    <div class="payment-section">
                        <label>üí≥ M√©todo de Pago</label>
                        <div class="payment-methods" role="radiogroup" aria-label="Seleccionar m√©todo de pago">
                            <button class="payment-btn active" data-metodo="efectivo" role="radio" aria-checked="true">
                                <span class="icon" aria-hidden="true">üíµ</span>
                                <span class="payment-text">
                                    <span>Efectivo</span>
                                    <small class="keyboard-hint">F1</small>
                                </span>
                            </button>
                            <button class="payment-btn" data-metodo="tarjeta" role="radio" aria-checked="false">
                                <span class="icon" aria-hidden="true">üí≥</span>
                                <span class="payment-text">
                                    <span>Tarjeta</span>
                                    <small class="keyboard-hint">F2</small>
                                </span>
                            </button>
                            <button class="payment-btn" data-metodo="transferencia" role="radio" aria-checked="false">
                                <span class="icon" aria-hidden="true">üì±</span>
                                <span class="payment-text">
                                    <span>Transferencia</span>
                                    <small class="keyboard-hint">F3</small>
                                </span>
                            </button>
                        </div>
                    </div>

                    <button id="processPayment" class="btn-action primary" aria-label="Procesar venta" style="width: 100%; justify-content: center; margin-top: 1rem;">
                        <span class="btn-icon">üí∞</span>
                        <span class="btn-text">Cobrar <span id="paymentTotal">$0</span></span>
                    </button>
                </div>
            </aside>
        </div>
    </main>

    <!-- Modal Control de Caja -->
    <div id="cashModal" class="modal" style="display: none;">
        <div class="modal-content cash-modal">
            <div class="modal-header">
                <h2 id="cashModalTitle">üí∞ Apertura de Caja</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Apertura de Caja -->
                <div id="cashOpenSection">
                    <div class="cash-form-group">
                        <label for="initialAmount">üíµ Monto Inicial en Caja</label>
                        <input type="number" id="initialAmount" placeholder="0" min="0" step="1000">
                        <small>Dinero en efectivo con que inicia el turno</small>
                    </div>
                    
                    <div class="cash-form-group">
                        <label for="operatorName">üë§ Operador</label>
                        <input type="text" id="operatorName" placeholder="Nombre del cajero">
                    </div>
                    
                    <button id="openCashBtn" class="btn-action primary">
                        <span class="btn-icon">üîì</span>
                        <span class="btn-text">Abrir Caja</span>
                    </button>
                </div>
                
                <!-- Cierre de Caja -->
                <div id="cashCloseSection" style="display: none;">
                    <div class="cash-summary">
                        <h3>üìä Resumen del Turno</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="label">üí∞ Monto Inicial:</span>
                                <span id="summaryInitial">$0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">üíµ Ventas Efectivo:</span>
                                <span id="summaryCashSales">$0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">üí≥ Ventas Tarjeta:</span>
                                <span id="summaryCardSales">$0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">üì§ Retiros:</span>
                                <span id="summaryWithdrawals" class="negative">-$0</span>
                            </div>
                            <div class="summary-item expected">
                                <span class="label">üéØ Efectivo Esperado:</span>
                                <span id="expectedCash">$0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="cash-count">
                        <h3>üí∏ Conteo Real de Caja</h3>
                        <div class="cash-form-group">
                            <label for="actualCash">Efectivo Contado</label>
                            <input type="number" id="actualCash" placeholder="0" min="0" step="1000">
                        </div>
                        
                        <div class="difference-alert" id="differenceAlert" style="display: none;">
                            <div class="alert-content">
                                <span class="alert-icon">‚ö†Ô∏è</span>
                                <span class="alert-text">
                                    <strong>Diferencia detectada:</strong>
                                    <span id="differenceAmount">$0</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <button id="closeCashBtn" class="btn-action danger">
                        <span class="btn-icon">üîí</span>
                        <span class="btn-text">Cerrar Caja</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal B√∫squeda por C√≥digo -->
    <div id="codeSearchModal" class="modal" style="display: none;">
        <div class="modal-content code-modal">
            <div class="modal-header">
                <h2>üîç Buscar por C√≥digo</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="code-input-group">
                    <input type="text" id="codeSearchInput" placeholder="Escanea o escribe c√≥digo" autocomplete="off">
                    <button id="cameraBtn" class="btn-action secondary">
                        <span class="btn-icon">üì±</span>
                        <span class="btn-text">C√°mara</span>
                    </button>
                </div>
                
                <!-- Resultado de b√∫squeda -->
                <div id="codeSearchResult" class="search-result" style="display: none;"></div>
                
                <!-- Scanner de c√°mara -->
                <div id="cameraSection" style="display: none;">
                    <video id="cameraVideo" autoplay playsinline></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <button id="stopCameraBtn" class="btn-action secondary">Detener C√°mara</button>
                </div>
            </div>
        </div>
    </div>

    <script src="pos-app.js"></script>
</body>
</html>